export const preload = async ({ id, origin }) => {
  const { views, date } = await fetch(`${origin}/api/views/${id}`).then(
    response => response.json()
  );
  return {
    layout: {
      views,
      date,
      title: '코드 블록을 이리저리 옮기는 것, 그건 중요한 일입니다',
      description:
        '코드리뷰는 물론 좋은 문화입니다. 하지만 진짜 좋은 팀에서는 강력한 프로세스 없이도 부담없이 서로의 코드를 보고 보다 자연스럽게 조언해주거나 수정해줄 수 있을 것입니다.',
      openGraph: {
        title: '코드 블록을 이리저리 옮기는 것, 그건 중요한 일입니다',
        description:
          '코드리뷰는 물론 좋은 문화입니다. 하지만 진짜 좋은 팀에서는 강력한 프로세스 없이도 부담없이 서로의 코드를 보고 보다 자연스럽게 조언해주거나 수정해줄 수 있을 것입니다.',
        images: [
          {
            url: '/assets/posts/moving-code-important.png',
            width: 1024,
            height: 1024,
          },
        ],
      },
    },
  };
};

<img
  src="/assets/posts/moving-code-important.png"
  style={{ height: '300px', width: '100%', objectFit: 'cover' }}
/>

## 개요

선배들끼리의 대화 중, 누군가의 리팩터링 결과물을 평가하는 이야기를 들은 적이 있습니다.

> 코드를 개선했다고? 그냥 코드를 이리저리 옮겼을 뿐이잖아?

평소 존경하던 선배의 발언이었기에, 그 말이 옳다고 여겨졌습니다. 리팩터링에는 합당한 이유가 있어야 하며, 단순히 코드를 이리저리 옮겨 놓고 개선했다고 주장하는 것은 프로답지 못하게 보였습니다.

특히 성과를 입증해야 하는 회사에서는 그 선배의 말이 더욱 타당하게 느껴졌습니다. 하지만 경험이 쌓이면서, 명확한 이유가 없더라도 코드를 이리저리 옮기는 일이 오히려 권장할 만한 일이라는 생각으로 바뀌었습니다.

개인적인 견해이지만, 제 생각을 한 번 이야기해 보겠습니다.

## 죽은코드

'죽은 코드'는 더 이상 손대지 않고 방치되는 코드를 말합니다.

물론 더 이상 수정할 필요가 없는 코드도 있습니다. 하지만 자주 수정되어야 할 법한 중요한 코드가 지나치게 복잡해져, 모두가 수정을 꺼리는 상태라면 그것은 사실상 죽은 코드라고 할 수 있습니다.

죽은 코드는 누군가의 결정적인 작업으로 갑자기 '짠!' 하고 생기는 것이 아닙니다. 여러 사람의 손을 거치며, 다양한 사연을 품고 점점 복잡해진 끝에 결국 죽은 코드가 되는 것입니다.

복잡해진 코드는 파악하기도 어렵고, 조금이라도 잘못 수정하면 사이드 이펙트로 여기저기에 영향을 미치기 때문에 누구도 쉽사리 손대지 못하는 코드가 됩니다.

그렇다면 죽은 코드를 어떻게 예방할 수 있을까요? 가장 쉽게 떠오르는 방법은 미리미리 성실하게 테스트 코드를 작성해 두는 것입니다. 하지만 코드 리뷰나 테스트 코드가 만능은 아니라고 생각합니다. 테스트 코드 자체도 죽은 코드가 될 수 있으며, 테스트 코드라는 것도 너무 과하거나 잘못 작성되어 있다면 오히려 더 헷갈리고, 죽은 코드를 만드는 데 한몫할 수 있습니다. 커버리지만을 의식한 코드보다는, 적절하고 효율적으로 짜인 테스트 코드가 더 좋다고 생각합니다.

이 글의 주제는 테스트 코드가 아니므로, 이쯤에서 넘어가겠습니다. 제가 하고 싶은 이야기는 ‘마음가짐’, ‘습관’, 그리고 ‘문화’에 대한 것입니다.

## 죽은 코드가 되지 않으려면, 코드를 자주 이리저리 고쳐야 합니다

죽은 코드를 예방하려면 어떻게 해야 할까요? 제가 말하고 싶은 핵심은 코드에 대한 관심과 태도입니다.

비유하자면, 한 아이의 부모가 자신의 아이에게 관심을 갖는 것과 비슷합니다. 코드를 아이 다루듯이, 책임감 있게 바라봐야 한다는 뜻입니다.

아무런 보살핌 없이, '짠!' 하고 완벽한 인성으로 자라는 아이는 없습니다. 잘못된 부분은 자꾸 알려주고, 고쳐줘야 건강하게 성장할 수 있습니다.

코드도 마찬가지입니다. 코드를 한 번에 ‘짠’ 하고 완벽하게 짤 수 있는 사람은 없습니다. 스스로 아무리 잘 짰다고 생각하고, 코드 리뷰를 완벽하게 통과한 코드라도, 시간이 조금만 지나면 허점과 부족한 부분이 보이기 마련입니다. 이럴 때마다 조금씩 수정해주는 관심과 손길이 필요합니다.

저도 어디선가 들은 이야기지만, 숙련된 개발자들도 대체로 최소 3~4번의 리팩터링을 거쳐야, 작성자 본인이 봤을 때 ‘그럭저럭 괜찮다’고 느끼는 수준에 도달한다고 합니다. 하물며 그 코드가 작성자가 아닌 다른 사람의 눈에는 여전히 부족하게 느껴질 수도 있겠죠.

결국, 완벽한 코드는 없습니다. 그래서 적당한 수준에서 만족하는 지혜도 필요합니다. 너무 빈틈없이 최적화된 코드는 오히려 나중에 변경이 더 어려워지는 코드가 될 수도 있습니다.
완벽한 최적화보다는, 장기적인 유지보수 관점에서 접근하는 것이 더 바람직하다고 생각합니다.

또, 코드를 개선하는 작업을 너무 거창하게 생각하면 오히려 부담감만 커집니다. 개발을 하던 중, 연관된 부분의 코드를 참고하거나 파악할 때, 원래 위치가 아닌 듯한 부자연스러운 코드가 보인다면, 그 코드를 적절한 위치로 옮기고, 주변 코드들과 추상화 수준을 맞춰주는 것만으로도 흐름이 훨씬 좋아집니다. 그렇게 하면 가독성이 향상되고, 자연스럽게 죽은 코드를 예방할 수 있습니다.

이렇게 이리 옮기고 저리 옮긴 코드들은 기능적으로도 올바르게 분리된 좋은 코드 베이스로 발전하게 됩니다. 결과적으로, 더 높은 수준의 리팩터링이 필요한 경우에도, 훨씬 수월하게 고칠 수 있는 기반이 마련되는 것입니다.

## 신뢰와 애정이 만드는 더 좋은 코드

꼭 자신이 작성한 코드가 아니더라도, 같은 팀의 누구나 실패에 대한 부담 없이 코드를 고칠 수 있어야 합니다.

제가 읽은 책들에서는 이를 **'보이스카웃 규칙(Boy Scout Rule)'** 이라고 하더군요. "그곳을 발견했을 때보다 떠날 때 더 나은 곳이어야 한다"는 원칙입니다. 남이 내 코드를 수정하거나 내가 남의 코드를 수정하기 위해서는, 코드를 공유하는 팀원 간의 신뢰가 전제되어야 합니다.

이런 신뢰가 쌓여 있는 개발팀은 남의 코드를 자유롭게 고치거나 남이 내 코드를 고치는 것에 대한 거부감이 적습니다. 저는 이것이야말로 진정한 팀워크라고 생각합니다.

코드리뷰는 물론 좋은 문화입니다. 하지만 진짜 좋은 팀에서는 강력한 프로세스 없이도 부담없이 서로의 코드를 보고 보다 자연스럽게 조언해주거나 수정해줄 수 있을 것입니다.

물론, 이런 문화를 만들기 위해서는 개발자 각자의 자질도 중요하고 서로의 책임을 따지고 묻는 경직된 분위기에서는 결코 생겨날 수 없습니다.

그리고 아이가 장난감을 가지고 놀게 했다면, 정리할 시간도 함께 주어야 합니다. 코드도 마찬가지입니다.

기능 개발을 충분히 했다면, 그 과정에서 추가된 코드가 주변과 잘 어울리도록 정리할 시간도 필요합니다. 하지만 기능 중심으로만 운영되는 팀에서는 이런 일이 자연스럽게 이루어지기 어렵습니다.

너무 강하게 프로세스화된 개발 문화는 오히려 독이 될 수 있습니다. 좋은 팀에서는 리더가 강제하지 않아도, 자연스럽게 좋은 코드가 나오며, 프로세스가 간소화될수록 오히려 퍼포먼스는 향상될 수 있습니다.

이런 모든 일은 팀과 동료에 대한 관심과 신뢰가 바탕이 된 문화에서만 가능합니다.

## 좋은 코드 문화는 애착과 자율에서 나옵니다

"코드에 너무 애착을 가지지 말라"는 말을 하는 사람들도 있습니다. 애착이 지나치면, 최초에 작성한 코드에 대한 집착이 생기고, 다른 사람의 조언에 과민해질 수 있기 때문입니다.

하지만 제 생각은 조금 다릅니다. 자신의 코드에 애착이 없다면, 시간이 지나도 문제 없이 유지될 수 있도록 코드를 정성껏 가꿔나가는 것이 과연 가능할까요?

저는 오히려 애착을 가지되, 자신이 작성한 코드의 문제점을 인정하고 수용할 수 있는 태도가 더 올바른 자세라고 생각합니다.

우리는 사랑하는 아이를 방치하지 않습니다. 올바르게 성장할 수 있도록, 좋은 가치관, 습관, 사회적 규칙 등을 알려주고 지속적으로 관심을 기울입니다.

코드도 마찬가지입니다. 애착이 없다면 결국 방치하게 됩니다.

물론 어떤 팀은 "코드에 애착이 없더라도, 강력한 코드 리뷰 프로세스가 있으면 해결된다" 고 생각할 수도 있습니다.

하지만 코드 리뷰에만 의존하게 되면, 개발자들은 점점 **'리뷰만 통과하면 된다'** 는 태도를 갖게 되고, 최소 기준만 맞추는 코드를 적당히 짜는 방향으로 흘러가기 쉽습니다. 그리고 **"이건 리뷰 통과했으니까 문제 없어"** 라는 안일한 인식도 생깁니다.

그 결과, 문제가 생길 때마다 더 강력하고 번거로운 절차들이 추가되고 점점 서로를 감시하고 통제하는 분위기가 만들어지며 팀워크는 오히려 나빠질 수 있습니다.

저는 이렇게 생각합니다.
좋은 개발 문화를 가진 팀이란 강력한 규범, 프로세스, 성과 지표에 의존하는 팀이 아닙니다.

오히려 그 반대입니다. 강력한 규범은 차선책일 뿐, 가장 중요한 것은 개개인의 애착 자율성 그리고 신뢰입니다.

## 결론

어떤 조직에서는 코드 변경의 명분과 성과 지표를 만들기 위해, 변경 이유를 억지로 덧붙여야 할 수도 있습니다. 그게 잘못된 일이라고 단정할 수는 없습니다.

하지만 기존의 코드 블록을 이리저리 옮기는 일은 지극히 자연스러운 행동이며, 장려되고 칭찬받아야 할 일임에는 분명합니다.

굳이 명확한 이유를 붙이자면 붙일 수도 있겠지만, 그냥 보기 좋게 만들고 싶어서라는 이유만으로도 충분합니다.

오히려 그건 코드를 방치하는 사람보다 훨씬 더 프로다운 태도이고, 좋은 습관을 지닌 순수한 동기의 개발자라고 말할 수 있습니다.
